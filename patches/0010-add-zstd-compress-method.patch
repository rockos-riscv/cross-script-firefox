From 44f4b65eadce13e414730533ae5d7c0a85f85162 Mon Sep 17 00:00:00 2001
From: CHEN <chenxuan@iscas.ac.cn>
Date: Thu, 16 Oct 2025 09:59:41 +0000
Subject: [PATCH 10/12] add zstd compress method

---
 toolkit/mozapps/installer/upload-files.mk | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/toolkit/mozapps/installer/upload-files.mk b/toolkit/mozapps/installer/upload-files.mk
index 09a33095f0..1e0cd331f4 100644
--- a/toolkit/mozapps/installer/upload-files.mk
+++ b/toolkit/mozapps/installer/upload-files.mk
@@ -10,7 +10,7 @@ ifndef MOZ_PKG_FORMAT
     else ifeq ($(OS_ARCH),SunOS)
         MOZ_PKG_FORMAT = XZ
     else ifeq ($(MOZ_WIDGET_TOOLKIT),gtk)
-        MOZ_PKG_FORMAT = XZ
+        MOZ_PKG_FORMAT = ZST
     else ifeq ($(MOZ_WIDGET_TOOLKIT),android)
         MOZ_PKG_FORMAT = APK
     else
@@ -110,6 +110,12 @@ ifeq ($(MOZ_PKG_FORMAT),XZ)
   INNER_MAKE_PACKAGE 	= cd $(1) && $(CREATE_FINAL_TAR) - $(MOZ_PKG_DIR) | xz --compress --stdout $(if $(MOZ_PROFILE_USE),-9 --extreme) > $(PACKAGE)
 endif
 
+ifeq ($(MOZ_PKG_FORMAT),ZST)
+  PKG_SUFFIX = .tar.zst
+  INNER_MAKE_PACKAGE   = cd $(1) && $(CREATE_FINAL_TAR) - $(MOZ_PKG_DIR) | zstd -T0 > $(PACKAGE)
+  INNER_UNMAKE_PACKAGE = cd $(1) && zstd -T0 --decompress --stdout $(UNPACKAGE) | $(UNPACK_TAR)
+endif
+
 ifeq ($(MOZ_PKG_FORMAT),BZ2)
   PKG_SUFFIX	= .tar.bz2
   ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))
-- 
2.48.1

