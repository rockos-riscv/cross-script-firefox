From ea9f51b11eff7d537296a78ae45d7a8bff5507ea Mon Sep 17 00:00:00 2001
From: Sakura286 <Sakura286>
Date: Mon, 1 Sep 2025 08:04:07 +0000
Subject: [PATCH 10/12] add zstd compress method

---
 toolkit/mozapps/installer/upload-files.mk | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/toolkit/mozapps/installer/upload-files.mk b/toolkit/mozapps/installer/upload-files.mk
index f301e254e1..ad06febd1a 100644
--- a/toolkit/mozapps/installer/upload-files.mk
+++ b/toolkit/mozapps/installer/upload-files.mk
@@ -10,7 +10,7 @@ ifndef MOZ_PKG_FORMAT
     else ifeq ($(OS_ARCH),SunOS)
         MOZ_PKG_FORMAT = XZ
     else ifeq ($(MOZ_WIDGET_TOOLKIT),gtk)
-        MOZ_PKG_FORMAT = XZ
+        MOZ_PKG_FORMAT = ZST
     else ifeq ($(MOZ_WIDGET_TOOLKIT),android)
         MOZ_PKG_FORMAT = APK
     else
@@ -109,6 +109,12 @@ ifeq ($(MOZ_PKG_FORMAT),XZ)
   INNER_MAKE_PACKAGE 	= cd $(1) && $(CREATE_FINAL_TAR) - $(MOZ_PKG_DIR) | xz --compress --stdout -9 --extreme > $(PACKAGE)
 endif
 
+ifeq ($(MOZ_PKG_FORMAT),ZST)
+  PKG_SUFFIX = .tar.zst
+  INNER_MAKE_PACKAGE   = cd $(1) && $(CREATE_FINAL_TAR) - $(MOZ_PKG_DIR) | zstd -T0 > $(PACKAGE)
+  INNER_UNMAKE_PACKAGE = cd $(1) && zstd -T0 --decompress --stdout $(UNPACKAGE) | $(UNPACK_TAR)
+endif
+
 ifeq ($(MOZ_PKG_FORMAT),BZ2)
   PKG_SUFFIX	= .tar.bz2
   ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))
-- 
2.43.0

